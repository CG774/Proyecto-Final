---- PROCEDIMIENTOS ALMACENADOS---

----AGREGAR UN PRODUCTO

DELIMITER $$

CREATE OR REPLACE PROCEDURE AgregarProducto(
    IN nombreProducto VARCHAR(100)
)
BEGIN
    -- Insertar el producto en la tabla 'productos'
    INSERT INTO productos(nombre_producto) VALUES (nombreProducto);
    
    -- Obtener el ID del Ãºltimo producto insertado
    SET @ultimoIdProducto = LAST_INSERT_ID();
    
    -- Insertar el registro correspondiente en 'detalle_inventario' con el nombre y cantidad inicial de 0
    INSERT INTO detalle_inventario(nombre_producto, cantidad_total_kg) 
    VALUES (nombreProducto, 0.00);
END$$

DELIMITER ;



---ACTUALIZAR UN PRODUCTO
DELIMITER $$

CREATE PROCEDURE ActualizarProductoPorID(
    IN _id_producto INT,
    IN _nombre_producto VARCHAR(100)
)
BEGIN
    UPDATE productos
    SET nombre_producto = _nombre_producto
    WHERE id_producto = _id_producto;
END$$

DELIMITER ;

---AGREGAR UN PROVEEDOR
DELIMITER $$

CREATE PROCEDURE AgregarProveedor(
    IN _nombre_proveedor VARCHAR(100),
    IN _telefono_proveedor VARCHAR(20),
    IN _id_producto INT
)
BEGIN
    INSERT INTO proveedores (nombre_proveedor, telefono_proveedor, id_producto) VALUES (_nombre_proveedor, _telefono_proveedor, _id_producto);
END$$

DELIMITER ;

---ACTUALIZAR PROVEEDOR POR ID
DELIMITER $$

CREATE PROCEDURE ActualizarProveedorPorId(
    IN _id_proveedor INT,
    IN _nombre_proveedor VARCHAR(100),
    IN _telefono_proveedor VARCHAR(20)
)
BEGIN
    UPDATE proveedores
    SET nombre_proveedor = _nombre_proveedor,
        telefono_proveedor = _telefono_proveedor
    WHERE id_proveedor = _id_proveedor;
END$$

DELIMITER ;

---AGREGAR registro_inventario
DELIMITER $$

CREATE OR REPLACE PROCEDURE AgregarEntradaInventario(
    IN idProveedor INT,
    IN idProducto INT,
    IN cantidadKg DECIMAL(10,2)
)
BEGIN
    -- Insertar la entrada de inventario
    INSERT INTO entradas_inventario(id_proveedor, id_producto, cantidad_kg) 
    VALUES (idProveedor, idProducto, cantidadKg);
    
    -- Verificar si el producto ya existe en detalle_inventario
    IF EXISTS (SELECT 1 FROM detalle_inventario WHERE nombre_producto = (SELECT nombre_producto FROM productos WHERE id_producto = idProducto)) THEN
        -- Actualizar la cantidad total en detalle_inventario
        UPDATE detalle_inventario
        SET cantidad_total_kg = cantidad_total_kg + cantidadKg
        WHERE nombre_producto = (SELECT nombre_producto FROM productos WHERE id_producto = idProducto);
    ELSE
        -- Insertar un nuevo registro en detalle_inventario si el producto no existe
        INSERT INTO detalle_inventario(nombre_producto, cantidad_total_kg) 
        VALUES ((SELECT nombre_producto FROM productos WHERE id_producto = idProducto), cantidadKg);
    END IF;
END$$

DELIMITER ;


